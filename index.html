<style>
    /* Анимация Злой Пчелы */
    .angry-bee {
        position: fixed;
        width: 80px;
        z-index: 9999;
        display: none;
        pointer-events: none;
        filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
    }

    @keyframes flyAcross {
        0% { left: -100px; top: 50%; transform: scaleX(1); }
        50% { left: 50%; top: 30%; transform: scaleX(1) rotate(10deg); }
        100% { left: 110%; top: 60%; transform: scaleX(1); }
    }

    .bee-flying {
        display: block !important;
        animation: flyAcross 1.5s linear forwards;
    }
</style>

<img id="bee" src="https://raw.githubusercontent.com/irinschensmagen-alt/Redaktor-/main/%D0%97%D0%BB%D0%B0%D1%8F%20%D0%BF%D1%87%D0%B5%D0%BB%D0%B0.png" class="angry-bee">

<script>
// ОБНОВЛЕННАЯ ФУНКЦИЯ ЭКСПОРТА
function exportGame() {
    const bee = document.getElementById('bee');
    
    // 1. Запускаем пчелу!
    bee.classList.add('bee-flying');
    
    // Ждем, пока пчела пролетит (1.5 сек), прежде чем скачивать
    setTimeout(() => {
        // 2. Создаем копию для экспорта
        const clone = document.documentElement.cloneNode(true);
        
        // 3. УДАЛЯЕМ редактор и пчелу из файла ученика
        const grid = clone.querySelector('#editorGrid');
        const controls = clone.querySelector('.header-controls');
        const beeInClone = clone.querySelector('#bee');
        
        if(grid) grid.remove();
        if(controls) controls.remove();
        if(beeInClone) beeInClone.remove(); // Ученик не должен видеть пчелу при старте
        
        // 4. Очищаем стили анимации в клоне, чтобы файл был чистым
        const wrapper = clone.querySelector('#mainWrapper');
        if(wrapper) wrapper.style.border = "none"; 

        // 5. Генерация файла
        const blob = new Blob([clone.outerHTML], {type: "text/html"});
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "Funny_Painter_READY.html";
        a.click();
        
        // Убираем пчелу в редакторе после полета
        bee.classList.remove('bee-flying');
    }, 1500);
}

// ВАЖНО: Не забывайте про автосохранение, оно работает в фоне
function autoSaveEditor() {
    const data = {
        lvl: document.getElementById('gameLvl').value,
        words: Array.from(document.querySelectorAll('textarea')).map(t => t.value)
    };
    localStorage.setItem('funny_painter_save', JSON.stringify(data));
}
</script>
